graph TB
    subgraph Frontend["Frontend · Next.js + Tailwind + shadcn/ui"]
        ChatUI["Chat Interface"]
        AgentStream["Agent Activity Stream"]
        SourceCards["Source Cards & Citations"]
    end

    subgraph Backend["Backend · FastAPI + Python"]
        API["API Gateway"]
        SessionMgr["Session Manager"]
        DaytonaMgr["Daytona Manager"]

        subgraph DaytonaSandbox["Daytona Sandbox · Ephemeral per session"]
            SandboxRunner["sandbox_runner.py"]

            subgraph AgentLayer["Agent Layer · Claude Agent SDK"]
                Orchestrator["Orchestrator Agent · Opus 4.6"]

                subgraph Subagents["Subagents"]
                    Research["Research Agent · Sonnet 4.5"]
                    Backlog["Backlog Agent · Sonnet 4.5"]
                    Prioritization["Prioritization Agent · Opus 4.6"]
                    DocWriter["Doc Agent · Opus 4.6"]
                end
            end

            subgraph MCPLayer["MCP Integration Layer"]
                SlackMCP["Slack MCP · stdio"]
                PMTools["PM Tools · in-process"]
            end
        end

        subgraph Persistence["Persistence Layer"]
            Redis["Redis · Session cache"]
            Memory["File Memory · Product knowledge"]
        end
    end

    subgraph External["External Services"]
        SlackAPI["Slack API"]
        LinearAPI["Linear API"]
        DaytonaAPI["Daytona Cloud"]
        ClaudeAPI["Anthropic API · Opus 4.6 + Sonnet 4.5"]
    end

    ChatUI -->|SSE| API
    AgentStream -->|SSE| API
    API --> SessionMgr
    SessionMgr --> DaytonaMgr
    DaytonaMgr -->|Create/Manage| DaytonaSandbox
    DaytonaMgr --> DaytonaAPI
    SandboxRunner --> Orchestrator
    Orchestrator --> Research
    Orchestrator --> Backlog
    Orchestrator --> Prioritization
    Orchestrator --> DocWriter

    Research --> SlackMCP
    Backlog --> PMTools
    PMTools -->|GraphQL| LinearAPI

    SlackMCP --> SlackAPI

    Orchestrator --> ClaudeAPI
    Research --> ClaudeAPI
    Backlog --> ClaudeAPI

    SessionMgr --> Redis
    Orchestrator --> Memory

    style Orchestrator fill:#7c3aed,color:#fff,stroke:#5b21b6
    style Research fill:#0ea5e9,color:#fff,stroke:#0284c7
    style Backlog fill:#0ea5e9,color:#fff,stroke:#0284c7
    style Prioritization fill:#7c3aed,color:#fff,stroke:#5b21b6
    style DocWriter fill:#7c3aed,color:#fff,stroke:#5b21b6
    style ClaudeAPI fill:#d97706,color:#fff,stroke:#b45309
    style DaytonaSandbox fill:#f0fdf4,stroke:#16a34a
    style DaytonaMgr fill:#16a34a,color:#fff,stroke:#15803d
    style DaytonaAPI fill:#16a34a,color:#fff,stroke:#15803d
